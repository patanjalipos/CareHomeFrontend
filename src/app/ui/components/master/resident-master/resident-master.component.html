<div class="card">

    <ng-wizard [config]="config" (stepChanged)="stepChanged($event)">
  
        <ng-wizard-step [title]="'1. Resident Details'" [description]="''"
          [canEnter]="isValidTypeBoolean" [canExit]="isValidFunctionReturnsBoolean.bind(this)">
          <div class="short-head mt-2">
            <ul>
                <li><button (click)="onClick('RI')" pTooltip="Resident Information" tooltipPosition="top">RI</button></li>
                <li><button (click)="onClick('HD')" pTooltip="Healthcare Details" tooltipPosition="top">HD</button></li>
                <li><button (click)="onClick('RP')" pTooltip="Resident Preferences" tooltipPosition="top">RP</button></li>
                <li><button (click)="onClick('DPA')" pTooltip="Details Prior to Admission" tooltipPosition="top">DPA</button></li>
            </ul>
        </div>
        <div class="care-cont">
        <div class="short-cont" id="RI">
            <h2>Resident Information</h2>
        </div>
        <div class="short-inner">
            <h4>Admission Details</h4>
            
        </div>
        <div class="short-cont" id="HD">
            <h2>Healthcare Details</h2>
        </div>
        <div class="short-inner">
            <h4>Admission Details</h4>
            
        </div>
        <div class="short-cont" id="RP">
            <h2>Resident Preferences</h2>
        </div>
        <div class="short-inner">
            <h4>Admission Details</h4>
            
        </div>
        <div class="short-cont" id="DPA">
            <h2>Details Prior to Admission</h2>
        </div>
        <div class="short-inner">
            <h4>Admission Details</h4>
            
        </div>
        </div>
        
        </ng-wizard-step>
        
        <ng-wizard-step [title]="'2. Clinical Details'" [description]="''" >
          <span>Step 2 content</span>
        </ng-wizard-step>
        
        <ng-wizard-step [title]="'3. Contacts'" [description]="''">
          <span>Step 3 content</span>
        </ng-wizard-step>
      
      <ng-wizard-step [title]="'4. Occupancy'" [description]="''">
          <span>Step 4 content</span>
        </ng-wizard-step>

      </ng-wizard>
</div>


<div *ngIf="mode==null">   
    <div class="card">
            <p-table #dt [value]="lstResidentMaster" responsiveLayout="scroll" styleClass="p-datatable-striped"
                [rowHover]="true" [globalFilterFields]="['MenuItemName','MenuItemURL','ParentMenuName','ModuleName']"
                [scrollable]="true" scrollHeight="calc(100vh - 215px)">
                <ng-template pTemplate="caption">
                    <div class="flex justify-content-between flex-column sm:flex-row">
                        <span class="p-ml-left">
                            <button pButton title="New" label="Add New" class="p-button-outlined mr-2" icon="pi pi-plus"
                            (click)="AddResident()"></button>
                            <span class="total-txt">
                            {{lstResidentMaster?.length>0?'Total Records:
                            '+filteredValuesLength:''}} </span> 
                        </span>    
                        <span class="p-ml-auto">
                            <button pButton title="Export Data" label=" " class="p-button-outlined mr-2"
                                icon="pi pi-download" (click)="exportToItemExcel();"></button>
                            <span class="p-input-icon-left">
                                <i class="pi pi-search"></i>
                                <input #filtr pInputText type="text" (input)="onGlobalFilter(dt, $event)"
                            placeholder="Search..." /></span>
                        </span>
                    </div>
                </ng-template>
                <ng-template pTemplate="emptymessage" let-columns>
                    <tr>
                        <td [attr.colspan]="columns?.length">
                            No records found
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th>Resident Id</th>
                        <th>Name</th>
                        <!-- <th>Profile Image</th> -->
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-dt let-i="rowIndex">
                    <tr>
                        <td>{{dt.ResidentNo}}</td>
                        <td>{{dt.FullName}}</td>
                        <!-- <td><img [src]="'assets/ui/images/avatar/' + dt.image" class="table-image"></td> -->
                        <td>{{dt.Status==1?'Active':'Inactive'}}</td>
                         <td>
                            <a matTooltip="View/Edit" (click)="LoadResidentDetails(dt.ResidentMasterId)">
                                <i class="fa fa-eye" aria-hidden="true"></i>
                            </a>
                        </td> 
                    </tr>
                </ng-template>
            </p-table>
        </div>   
</div>
<div class="card" *ngIf="mode!=null">
    <form #myForm="ngForm">
        <p-accordion [multiple]="true" activeIndex="0,1,2,3,4,5">
            <p-accordionTab header="Resident name" *ngIf="ResidentMasterId==null">
                <div class="row">
                    <div class="col-md-3" *ngIf="UserTypeCurre===UserTypes.SuperAdmin">
                        <label class="form-label">Home<span class="danger">*</span></label>
                        <p-dropdown [required]="true" name="ddlHome" [options]="lstHomeMaster"
                            [(ngModel)]="ResidentMaster.HomeId" optionLabel="HomeName"
                            optionValue="HomeId" [filter]="true" placeholder="--select--"
                            [style]="{width: '100%'}" #homeref="ngModel">
                        </p-dropdown>                        
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">Title</label>
                        <p-dropdown name="ddlTitle" [options]="stlsttitle"
                            [(ngModel)]="ResidentMaster.Title" optionLabel="name" optionValue="code"
                            [filter]="true" placeholder="Choose title" [style]="{width: '100%'}"
                           >
                        </p-dropdown>                        
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">First Name <span class="danger">*</span></label>
                        <input pInputText type="text" required class="form-control" name="txtFName"
                        [(ngModel)]="ResidentMaster.FirstName" placeholder=""
                        (keypress)="keyPress1($event)">                                
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Middle Name</label>
                        <input type="text" pInputText class="form-control" name="txtMiddleName"
                            [(ngModel)]="ResidentMaster.MiddleName" placeholder=""
                            (keypress)="keyPress1($event)">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Last Name <span class="danger">*</span></label>
                        <input type="text" pInputText class="form-control" name="txtLname"
                            [(ngModel)]="ResidentMaster.LastName" placeholder=""
                            (keypress)="keyPress1($event)">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Preferred Name</label>
                        <input pInputText type="text" class="form-control" name="txtFHName"
                            [(ngModel)]="ResidentMaster.PreferredName"
                            placeholder="">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status <span class="danger">*</span></label>
                        <p-dropdown [required]="true" name="ddlStatus" [options]="stlststatus"
                            [(ngModel)]="ResidentMaster.Status" optionLabel="name" optionValue="code"
                            [filter]="true" placeholder="Please Select Status" [style]="{width: '100%'}">
                        </p-dropdown>
                    </div>
                    <div class="col-md-12" *ngIf="(ResidentMaster.ProfileImage==null || ResidentMaster.ProfileImage==undefined || ResidentMaster.ProfileImage=='')">
                        <label class="form-label">Resident Photo</label>
                        <p-fileUpload name="file[]" [showUploadButton]="false" accept="image/*" [multiple]="true" [maxFileSize]="1000000" (onSelect)="fileUploader($event)" (onClear)="fileUploaderReset();"
                        (onRemove)="fileUploaderReset();"></p-fileUpload>
                    </div>
                    <div class="row m-0">
                    <div class="col-md-3 mt-2 border p-2 bdr6" *ngIf="(ResidentMaster.ProfileImage!=null && ResidentMaster.ProfileImage!=undefined && ResidentMaster.ProfileImage!='')">
                        <div align="left" class="wd-30">
                            <img style="height: 99px;" src="{{profileSrc}}{{ResidentMaster.ProfileImage}}">
                          </div>
                          <div class="wd-50">
                        <label class="form-label">Resident Photo</label>
                    </div>
                        <div class="wd-20">
                          <i title="Remove Photo" (click)="RemoveProfileImage()" class="fa fa-times removeicon p-button" aria-hidden="true"></i>
                    </div>
                    </div>
                    </div>
                </div>
            </p-accordionTab>
            <p-accordionTab header="Resident demographics" *ngIf="ResidentMasterId==null">
                <div class="row">                    
                    <div class="col-md-3">
                        <label class="form-label">Date Of Birth <span class="danger">*</span></label>
                        <p-calendar [required]="true" [maxDate]="todayDate"
                            [(ngModel)]="ResidentMaster.DateOfBirth"
                            [ngModelOptions]="{standalone: true}" [showIcon]="true" inputId="icon"
                            [dateFormat]="customDateFormat.CalendarFormat" #dobref="ngModel" class="iconcal"></p-calendar> 
                    </div>    
                    <div class="col-md-3">
                        <label class="form-label">Gender <span class="danger">*</span></label>
                        <p-dropdown [required]="true" name="ddlGender" [options]="stlstgender"
                            [(ngModel)]="ResidentMaster.Gender" optionLabel="name" optionValue="code"
                            [filter]="true" placeholder="Choose gender" [style]="{width: '100%'}"
                            #genderref="ngModel">
                        </p-dropdown>                        
                    </div>  
                    <div class="col-md-3">
                        <label class="form-label">I describe myself as</label>
                        <input pInputText type="text" class="form-control" name="txtMySelfDetails"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                    <div class="col-md-3">                        
                          <label class="form-label">Country of birth</label>
                          <p-dropdown name="ddlCountry" [options]="lstCountryMaster"
                            [(ngModel)]="ResidentMaster.CountryId" optionLabel="name"
                            optionValue="CountryId" [filter]="true" placeholder="Choose country"
                            [style]="{width: '100%'}">
                          </p-dropdown>
                                          
                      </div>
                    <div class="col-md-3">
                        <label class="form-label">Primary language spoken</label>
                        <input pInputText type="text" class="form-control" name="txtPrimaryLanguage"
                            [(ngModel)]="ResidentMaster.PrimaryLanguage"
                            placeholder="">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Secondary language spoken</label>
                        <input pInputText type="text" class="form-control" name="txtSecondaryLanguage"
                            [(ngModel)]="ResidentMaster.SecondaryLanguage"
                            placeholder="">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Religion</label>
                        <input pInputText type="text" class="form-control" name="txtReligion"
                            [(ngModel)]="ResidentMaster.Religion"
                            placeholder="">
                    </div>
                    <div class="col-md-3">                      
                          <label class="form-label" for="">Marital status</label>
                          <p-dropdown name="ddlMaritalStatus" [options]="stlstmaritalstatus"
                            [(ngModel)]="ResidentMaster.MaritalStatus" optionLabel="name" optionValue="code"
                             [filter]="true" placeholder="Choose status"
                            [style]="{width: '100%'}">
                          </p-dropdown>                        
                      </div>
                </div>                
            </p-accordionTab>  
            <p-accordionTab header="Funding" *ngIf="ResidentMasterId==null">
                <div class="row">                    
                    <div class="col-md-3">
                        <label class="form-label">Funding <span class="danger">*</span></label>
                        <p-dropdown [required]="true" name="ddlFunding" [options]="stlstfunding"
                            [(ngModel)]="ResidentMaster.Gender" optionLabel="name" optionValue="code"
                            [filter]="true" placeholder="Choose Funding" [style]="{width: '100%'}"
                            #Fundingref="ngModel">
                        </p-dropdown>                        
                    </div> 
                     <div class="col-md-3">
                        <label class="form-label">Payer Details - Name</label>
                        <input pInputText type="text" class="form-control" name="txtName"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Payer Details - Address</label>
                        <input pInputText type="text" class="form-control" name="txtAddress"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Payer Details - Postcode</label>
                        <input pInputText type="text" class="form-control" name="txtPostcode"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Payer Details - Telephone</label>
                        <p-inputNumber [(ngModel)]="ResidentMaster.MySelfDetails" name="txtTelephone"></p-inputNumber>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Payer Details - relationship to resident</label>
                        <input pInputText type="text" class="form-control" name="txtrelationship"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                </div>                
            </p-accordionTab> 
            <p-accordionTab header="Healthcare details" *ngIf="ResidentMasterId==null">
                <div class="row">                    
                    <div class="col-md-3">
                        <label class="form-label">NHS/CHI Number</label>
                        <input pInputText type="text" class="form-control" name="txtNHS"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">National Insurance Number</label>
                        <input pInputText type="text" class="form-control" name="txtInsuranceNumber"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                    <br>
                    <span><b>Memebership Details</b></span> 
                    <div class="col-md-3 mt-2">
                        <label class="form-label">Private health insurance provider</label>
                        <input pInputText type="text" class="form-control" name="txtPrivatehealth"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Memebers number</label>
                        <p-inputNumber [(ngModel)]="ResidentMaster.MySelfDetails" name="Memebersnumber"></p-inputNumber>
                    </div>
                </div>                
            </p-accordionTab>
            <p-accordionTab header="Resident preferences" *ngIf="ResidentMasterId==null">
                <div class="row">   
                    <div class="field-checkbox col-md-3">
                        <p-checkbox [(ngModel)]="ResidentMaster.MySelfDetails" [binary]="true" name="DNAR" inputId="binary"></p-checkbox>
                        <label for="binary"><b>DNAR/DNACPR is in place?</b></label>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">National Insurance Number</label>
                        <input pInputText type="text" class="form-control" name="txtNationalInsuranceNumber"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                    <br>
                    <span><b>Funeral preferences</b></span> 
                    <div class="col-md-3 mt-2">
                        <label class="form-label">Private health insurance provider</label>
                        <input pInputText type="text" class="form-control" name="txtphinsurance"
                            [(ngModel)]="ResidentMaster.MySelfDetails"
                            placeholder="">
                    </div>
                     <div class="col-md-3 mt-2">
                        <label class="form-label">Memebers number</label>
                        <p-inputNumber [(ngModel)]="ResidentMaster.MySelfDetails" name="Memebersnumber"></p-inputNumber>
                    </div>
                </div>                
            </p-accordionTab>
            <p-accordionTab header="Admission Details" *ngIf="ResidentMasterId!=null">
                <div class="row">                    
                    <div class="col-md-3">
                        <label class="form-label">Status<span class="danger">*</span></label>
                          <p-dropdown [required]="true" name="ddlStatuss" [options]="stlststatus"
                            [(ngModel)]="ResidentBookingDetails.Status" optionLabel="name"
                            optionValue="code" [filter]="true" placeholder="Choose Status"
                            [style]="{width: '100%'}">
                          </p-dropdown>
                    </div>    
                    <div class="col-md-3" *ngIf="UserTypeCurre===UserTypes.Admin">
                        <label class="form-label">Residency<span class="danger">*</span></label>
                        <p-dropdown [required]="true" name="ddlHomee" [options]="lstHomeMaster"
                            [(ngModel)]="ResidentBookingDetails.HomeId" optionLabel="HomeName"
                            optionValue="HomeId" [filter]="true" placeholder="--select--"
                            [style]="{width: '100%'}" #homeref="ngModel">
                        </p-dropdown>                        
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Dependency level<span class="danger">*</span></label>
                          <p-dropdown name="ddlDependencyMaster" [required]="true" [options]="lstDependencyMaster"
                            [(ngModel)]="ResidentBookingDetails.Dependencylevel" optionLabel="name"
                            optionValue="code" [filter]="true" placeholder="Choose Dependency"
                            [style]="{width: '100%'}">
                          </p-dropdown>
                    </div>    
                    <div class="col-md-3">
                        <label class="form-label">Location<span class="danger">*</span></label>
                          <p-dropdown name="ddllocation" [required]="true" [options]="lstCountryMaster"
                            [(ngModel)]="ResidentBookingDetails.CountryId" optionLabel="name"
                            optionValue="CountryId" [filter]="true" placeholder="Choose country"
                            [style]="{width: '100%'}">
                          </p-dropdown>
                    </div> 
                    <div class="col-md-3">
                        <label class="form-label">Room<span class="danger">*</span></label>
                          <p-dropdown name="ddlRoom" [required]="true" [options]="lstRoomMaster"
                            [(ngModel)]="ResidentBookingDetails.RoomId" optionLabel="name"
                            optionValue="code" [filter]="true" placeholder="Choose Room"
                            [style]="{width: '100%'}">
                          </p-dropdown>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Last date of admission<span class="danger">*</span></label>
                        <p-calendar [required]="true" [maxDate]="todayDate"
                            [(ngModel)]="ResidentBookingDetails.LastAdmDate"
                            [ngModelOptions]="{standalone: true}" [showIcon]="true" inputId="icon"
                            [dateFormat]="customDateFormat.CalendarFormat" #lastdtref="ngModel" class="iconcal"></p-calendar> 
                    </div>  
                    <div class="col-md-3">
                        <label class="form-label">Initial Admission Date<span class="danger">*</span></label>
                        <p-calendar [required]="true" [maxDate]="todayDate"
                            [(ngModel)]="ResidentBookingDetails.InitialAdmDate"
                            [ngModelOptions]="{standalone: true}" [showIcon]="true" inputId="icon"
                            [dateFormat]="customDateFormat.CalendarFormat" #initialadmdateref="ngModel" class="iconcal"></p-calendar> 
                    </div>  
                    <div class="col-md-3">
                        <label class="form-label">Departure Reason</label>
                        <input pInputText type="text" class="form-control" name="txtDepartureReason"
                        [(ngModel)]="ResidentBookingDetails.DepartureReason"
                        placeholder="">
                    </div>  
                </div>                
            </p-accordionTab>      
                 
        </p-accordion>                
            <div class="flex flex-wrap gap-2 mt-2">
                <button *ngIf="ResidentMasterId==null" pButton type="button" label="Submit" (click)="Submit()" [disabled]="!myForm.form.valid"></button>
                <button *ngIf="ResidentMasterId!=null" pButton type="button" label="Submit" (click)="SubmitAdmissionForm()" [disabled]="!myForm.form.valid"></button>
                <button pButton type="button" label="Close" class="p-button-secondary" (click)="CloseModal()"></button>
            </div>
    </form>
</div>  
<p-toast position="left-bottom"></p-toast>